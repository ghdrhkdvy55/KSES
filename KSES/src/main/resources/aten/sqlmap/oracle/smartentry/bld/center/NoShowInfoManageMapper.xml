<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kses.backoffice.bld.center.mapper.NoshowInfoManageMapper">
	<select id="selectNoshowInfoList" resultType="lmap">
		SELECT 
			A.NOSHOW_CD, 
			CASE A.NOSHOW_DAY
				WHEN '1' THEN '월요일'
				WHEN '2' THEN '화요일'
				WHEN '3' THEN '수요일'
				WHEN '4' THEN '목요일'
				WHEN '5' THEN '금요일'
				WHEN '6' THEN '토요일'
				WHEN '7' THEN '일요일'
			END NOSHOW_DAY, 
			TO_CHAR(TO_DATE(NOSHOW_AM_TM,'HH24MI'),'HH24:MI') AS NOSHOW_AM_TM, 
			TO_CHAR(TO_DATE(NOSHOW_PM_TM,'HH24MI'),'HH24:MI') AS NOSHOW_PM_TM,
			TO_CHAR(TO_DATE(NOSHOW_ALL_TM,'HH24MI'),'HH24:MI') AS NOSHOW_ALL_TM, 
			TO_CHAR(A.LAST_UPDT_DTM, 'yyyy-mm-dd') AS LAST_UPDT_DTM,
			A.LAST_UPDUSR_ID,  
			B.CENTER_NM
		FROM TSEB_NOSHOW_INFO_M A, TSEB_CENTER_INFO_M B
		WHERE A.CENTER_CD = #{centerCd}
		AND A.CENTER_CD = B.CENTER_CD  
	</select>
     
	<update id="updateNoshowInfo">
		<foreach collection="noshowInfoList" item="item" separator=";" open="DECLARE BEGIN" close="; END;">	
			UPDATE TSEB_NOSHOW_INFO_M SET 
				NOSHOW_AM_TM = #{item.noshowAmTm, jdbcType=VARCHAR}, 
				NOSHOW_PM_TM = #{item.noshowPmTm, jdbcType=VARCHAR},
				NOSHOW_ALL_TM = #{item.noshowAllTm, jdbcType=VARCHAR},
				LAST_UPDT_DTM = SYSDATE
			WHERE NOSHOW_CD = #{item.noshowCd}
		</foreach>
	</update>
	
	<update id="copyNoshowInfo">
		UPDATE TSEB_NOSHOW_INFO_M A
		SET (A.NOSHOW_AM_TM, A.NOSHOW_PM_TM, A.NOSHOW_ALL_TM, A.LAST_UPDT_DTM, A.LAST_UPDUSR_ID) = 
	   	(
	   		SELECT B.NOSHOW_AM_TM, B.NOSHOW_PM_TM, B.NOSHOW_ALL_TM, SYSDATE, 'COPY_TEST'
			FROM TSEB_NOSHOW_INFO_M B 
			WHERE A.NOSHOW_DAY = B.NOSHOW_DAY 
			AND B.CENTER_CD = #{params.copyCenterCd}
		)
		WHERE A.CENTER_CD = #{params.targetCenterCd}
	</update>
</mapper>